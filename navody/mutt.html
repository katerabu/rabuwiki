<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>MUTT - konfigurace, Å¡ifrovÃ¡nÃ­, autentizace a synchronizace</title></head>
<body>
<p>Tento nÃ¡vod popisuje, jak nakonfigurovat Mutt pro bezpeÄnÃ© odesÃ­lÃ¡nÃ­ a pÅ™ijÃ­mÃ¡nÃ­ e-mailÅ¯ s podporou GPG Å¡ifrovÃ¡nÃ­, autentizace pÅ™es OAuth2 a automatickou synchronizaci pomocÃ­ mbsync a cron.</p>
<h3>ğŸ› ï¸ Instalace potÅ™ebnÃ½ch balÃ­ÄkÅ¯</h3>
<pre><code>sudo apt update
sudo apt install mutt gnupg gpg-agent msmtp ca-certificates isync python3-requests python3-oauthlib python3-keyring
</code></pre>
<h3>ğŸ“ VytvoÅ™enÃ­ potÅ™ebnÃ½ch adresÃ¡Å™Å¯ a souborÅ¯</h3>
<pre><code>mkdir -p ~/.mutt/cache ~/.mail/{INBOX,Sent,Drafts} ~/.mutt-oauth2
touch ~/.mutt/muttrc ~/.mailpw.gpg ~/.mutt-oauth2/token.gpg
chmod 600 ~/.mailpw.gpg ~/.mutt-oauth2/token.gpg
</code></pre>
<h3>ğŸ§© Konfigurace Mutt (~/.mutt/muttrc)</h3>
<pre><code>set realname = "TvÅ¯j Nick"
set from = "[emailÂ protected]"
set use_from = yes
set envelope_from = yes
set sendmail="/usr/bin/msmtp"
set editor="nano"
set charset="utf-8"
set folder = "~/.mail"
set spoolfile = "+INBOX"
set record = "+Sent"
set postponed = "+Drafts"
set imap_authenticators = "oauthbearer"
set smtp_authenticators = "oauthbearer"
set imap_oauth_refresh_command = "python3 ~/.mutt-oauth2/mutt_oauth2.py ~/.mutt-oauth2/token.gpg"
set smtp_oauth_refresh_command = "python3 ~/.mutt-oauth2/mutt_oauth2.py ~/.mutt-oauth2/token.gpg"
</code></pre>
<h3>ğŸ¨ Barvy pro index view</h3>
<pre><code>color index brightcyan default ~N  # NovÃ© zprÃ¡vy
color index brightyellow default ~F  # Flagged zprÃ¡vy
color index green default ~T  # OdeslanÃ© zprÃ¡vy
color index brightred default ~D  # SmazanÃ© zprÃ¡vy
mono index bold ~N  # ZvÃ½raznÄ›nÃ­ novÃ½ch zprÃ¡v
mono index bold ~F  # ZvÃ½raznÄ›nÃ­ flagovanÃ½ch zprÃ¡v
mono index bold ~T  # ZvÃ½raznÄ›nÃ­ odeslanÃ½ch zprÃ¡v
mono index bold ~D  # ZvÃ½raznÄ›nÃ­ smazanÃ½ch zprÃ¡v

NEFUNGOVALO TOTO: color index brightgreen default ~f"odesÃ­latel@example.com" # Tato konfigurace zvÃ½raznÃ­ zprÃ¡vy od odesÃ­latele odesÃ­latel@example.com zelenÄ›.
</code></pre>
<h3>ğŸ” GPG Å¡ifrovÃ¡nÃ­ a podpis</h3>
<pre><code>set crypt_use_gpgme = yes
set crypt_autosign = yes
set crypt_autoencrypt = yes
set crypt_replyencrypt = yes
set crypt_replysign = yes
set crypt_replysignencrypted = yes
</code></pre>
<h3>ğŸ”„ VolitelnÃ©: spustit gpg-agent pÅ™i startu Mutt</h3>
<pre><code>set my_msmtp_pass=`gpg --quiet --no-tty --for-your-eyes-only --decrypt ~/.mailpw.gpg`
</code></pre>
<h3>ğŸ“§ Konfigurace msmtp (~/.msmtprc)</h3>
<pre><code>defaults
auth on
tls on
tls_starttls on
tls_trust_file /etc/ssl/certs/ca-certificates.crt

account default
host smtp.example.com
port 587
from [emailÂ protected]
user [emailÂ protected]
passwordeval "gpg --quiet --no-tty --for-your-eyes-only --decrypt ~/.mailpw.gpg"
</code></pre>
<h3>ğŸ” UloÅ¾enÃ­ hesla SMTP</h3>
<pre><code>echo "TvojeSMTP_Heslo" | gpg --default-recipient-self --encrypt &gt; ~/.mailpw.gpg
chmod 600 ~/.mailpw.gpg
</code></pre>
<h3>ğŸ§ª Konfigurace gpg-agent (napÅ™. v ~/.bashrc)</h3>
<pre><code>eval $(gpg-agent --daemon --enable-ssh-support --write-env-file ~/.gpg-agent-info)
export GPG_AGENT_INFO
export SSH_AUTH_SOCK=$(grep -R SSH_AUTH_SOCK ~/.gpg-agent-info | cut -d'=' -f2-)
export GPG_TTY=$(tty)
</code></pre>
<h3>ğŸ“¥ Konfigurace mbsync (~/.mbsyncrc)</h3>
<pre><code>IMAPAccount account
Host imap.example.com
User [emailÂ protected]
PassCmd "gpg --quiet --decrypt ~/.mailpw.gpg"
SSLType IMAPS
CertificateFile /etc/ssl/certs/ca-certificates.crt

IMAPStore store account
MaildirStore local ~/.mail/
Channel sync
Master :account:
Slave local
Patterns *
Create Slave
Sync Pull
</code></pre>
<h3>ğŸ”„ SpuÅ¡tÄ›nÃ­ synchronizace</h3>
<pre><code>mbsync sync
</code></pre>
<h3>ğŸ”„ SpuÅ¡tÄ›nÃ­ mutt-oauth2</h3>
<p>$ mutt-oauth2 --authorize
OAuth2 registration (google, microsoft) [google]:   stiskni ENTER    <br />
Account e-mail address: rabukate@gmail.com
Client ID:  56508150926.apps.googleusercontent.com
Client Secret:  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</p>
<h3>ğŸ“¬ SpuÅ¡tÄ›nÃ­ Mutt</h3>
<pre><code>mutt
</code></pre>
<h3>ğŸ•’ AutomatickÃ¡ synchronizace pomocÃ­ cron</h3>
<pre><code>crontab -e
# PÅ™idejte nÃ¡sledujÃ­cÃ­ Å™Ã¡dek pro synchronizaci kaÅ¾dÃ½ch 15 minut
*/15 * * * * mbsync sync
</code></pre>
<h3>ğŸ”‘ GenerovÃ¡nÃ­ a sprÃ¡va OAuth2 tokenu</h3>
<pre><code>wget https://gitlab.com/muttmua/mutt/-/raw/master/contrib/mutt_oauth2.py -O ~/.mutt-oauth2/mutt_oauth2.py
chmod +x ~/.mutt-oauth2/mutt_oauth2.py
python3 ~/.mutt-oauth2/mutt_oauth2.py ~/.mutt-oauth2/token.gpg --authorize

# Pro obnovenÃ­ tokenu
python3 ~/.mutt-oauth2/mutt_oauth2.py ~/.mutt-oauth2/token.gpg --refresh
</code></pre>
<h3>ğŸ§  Tipy a triky</h3>
<ul>
<li><strong>KlÃ¡vesovÃ© zkratky v Mutt</strong>:</li>
<li><code>m</code> = napsat zprÃ¡vu</li>
<li><code>c</code> = zmÄ›na sloÅ¾ky</li>
<li><code>g</code> = naÄÃ­st novou poÅ¡tu po mbsync</li>
<li>
<p><code>q</code> = ukonÄenÃ­</p>
</li>
<li>
<p><strong>BezpeÄnostnÃ­ tip</strong>: PouÅ¾Ã­vej <code>passwordeval</code> s GPG pro Å¡ifrovanÃ© heslo mÃ­sto uklÃ¡dÃ¡nÃ­ v plaintextu. <a href="https://wiki.archlinux.org/title/MSMTP">wiki.archlinux.org</a></p>
</li>
<li>
<p><strong>Synchronizace s IMAP</strong>: <code>mbsync</code> efektivnÄ› synchronizuje sloÅ¾ky mezi serverem a lokÃ¡lnÃ­m Maildir. <a href="https://isync.sourceforge.io/mbsync.html">isync.sourceforge.io</a></p>
</li>
<li>
<p><strong>AutomatickÃ© spuÅ¡tÄ›nÃ­ gpg-agent</strong>: PouÅ¾itÃ­ <code>eval $(gpg-agent --daemon ...)</code> v <code>~/.bashrc</code> zajistÃ­, Å¾e gpg-agent bude spuÅ¡tÄ›n pÅ™i kaÅ¾dÃ©m pÅ™ihlÃ¡Å¡enÃ­. <a href="https://cryptomonkeys.com/2015/09/mutt-and-msmtp-on-osx/">cryptomonkeys.com</a></p>
</li>
<li>
<p><strong>OAuth2 s Gmail</strong>: Pro Gmail pouÅ¾ij <code>oauthbearer</code> autentizaci. <a href="https://wiki.archlinux.org/title/MSMTP">wiki.archlinux.org</a></p>
</li>
<li>
<p>**OAuth2 s Microsoft
::contentReference[oaicite:5]{index=5}</p>
</li>
</ul>
<p><a href="../index.html">â† ZpÄ›t na pÅ™ehled</a></p>
</body>
</html>
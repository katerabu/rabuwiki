<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>backupwin â€“ zÃ¡lohovÃ¡nÃ­ z Win do RPi5</title></head>
<body>
<h1>README: Å ifrovanÃ© zÃ¡lohovÃ¡nÃ­ ze dvou Windows 11 notebookÅ¯ na Raspberry Pi 5 s NVMe 2TB ğŸ”ğŸ’¾ğŸ–¥ï¸</h1>
<hr />
<h2>Obsah ğŸ“š</h2>
<ol>
<li><a href="#pÅ™ehled-projektu">PÅ™ehled projektu</a>  </li>
<li><a href="#hardware-a-sÃ­Å¥ovÃ©-prostÅ™edÃ­">Hardware a sÃ­Å¥ovÃ© prostÅ™edÃ­</a>  </li>
<li><a href="#poÅ¾adavky-a-nÃ¡stroje">PoÅ¾adavky a nÃ¡stroje</a>  </li>
<li><a href="#pÅ™Ã­prava-raspberry-pi-5-raspbian">PÅ™Ã­prava Raspberry Pi 5 (Raspbian)</a>  </li>
<li><a href="#vytvoÅ™enÃ­-a-montovÃ¡nÃ­-veracrypt-kontejnerÅ¯">VytvoÅ™enÃ­ a montovÃ¡nÃ­ VeraCrypt kontejnerÅ¯</a>  </li>
<li><a href="#nastavenÃ­-samba-serveru">NastavenÃ­ Samba serveru</a>  </li>
<li><a href="#nastavenÃ­-ssh-klÃ­ÄÅ¯-pro-bezpeÄnÃ½-pÅ™Ã­stup">NastavenÃ­ SSH klÃ­ÄÅ¯ pro bezpeÄnÃ½ pÅ™Ã­stup</a>  </li>
<li><a href="#powershell-zÃ¡lohovacÃ­-skripty-pro-windows-11--nastavenÃ­-plÃ¡novaÄe-Ãºloh">PowerShell zÃ¡lohovacÃ­ skripty pro Windows 11 + nastavenÃ­ PlÃ¡novaÄe Ãºloh</a>  </li>
<li><a href="#tipy-a-bezpeÄnostnÃ­-doporuÄenÃ­">Tipy a bezpeÄnostnÃ­ doporuÄenÃ­</a>  </li>
<li><a href="#zdroje-citace-a-odkazy">Zdroje, citace a odkazy</a>  </li>
</ol>
<hr />
<h2>1. PÅ™ehled projektu ğŸ“</h2>
<p>ZÃ¡lohovÃ¡nÃ­ dat ze dvou Windows 11 notebookÅ¯ do Å¡ifrovanÃ½ch VeraCrypt kontejnerÅ¯ na Raspberry Pi 5 s NVMe diskem 2TB.<br />
KaÅ¾dÃ½ notebook mÃ¡ vlastnÃ­ uÅ¾ivatelskÃ½ ÃºÄet a vlastnÃ­ 512GB VeraCrypt kontejner.<br />
Data se pÅ™es Samba sdÃ­lenÃ­ bezpeÄnÄ› pÅ™enÃ¡Å¡ejÃ­ pÅ™es lokÃ¡lnÃ­ intranet IPv4 subnet.  </p>
<hr />
<h2>2. Hardware a sÃ­Å¥ovÃ© prostÅ™edÃ­ ğŸ–¥ï¸ğŸ“¡</h2>
<ul>
<li><strong>Raspberry Pi 5</strong> s NVMe SSD 2TB  </li>
<li>OS: Raspbian (aktuÃ¡lnÃ­ verze)  </li>
<li>SÃ­Å¥: Intranet IPv4, jeden subnet (napÅ™. 192.168.1.0/24)  </li>
<li>Dva Windows 11 notebooky, kaÅ¾dÃ½ s vlastnÃ­m uÅ¾ivatelem a heslem  </li>
</ul>
<hr />
<h2>3. PoÅ¾adavky a nÃ¡stroje ğŸ› ï¸</h2>
<ul>
<li>VeraCrypt na Raspberry Pi  </li>
<li>Samba server na Raspberry Pi  </li>
<li>SSH server na Raspberry Pi  </li>
<li>Windows 11 PowerShell na noteboocÃ­ch  </li>
<li>SSH klient (OpenSSH je v Windows 11 standardnÄ› dostupnÃ½)  </li>
</ul>
<hr />
<h2>4. PÅ™Ã­prava Raspberry Pi 5 (Raspbian) âš™ï¸ğŸ§</h2>
<h3>Aktualizace systÃ©mu</h3>
<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y
</code></pre>
<h3>Instalace VeraCrypt, Samba, SSH</h3>
<pre><code>sudo apt install veracrypt samba ssh -y
</code></pre>
<h3>VytvoÅ™enÃ­ uÅ¾ivatelskÃ½ch ÃºÄtÅ¯ pro Samba</h3>
<pre><code>sudo adduser backupuser1
sudo smbpasswd -a backupuser1

sudo adduser backupuser2
sudo smbpasswd -a backupuser2
</code></pre>
<hr />
<h2>5. VytvoÅ™enÃ­ a montovÃ¡nÃ­ VeraCrypt kontejnerÅ¯ ğŸ”’</h2>
<h3>VytvoÅ™enÃ­ 512 GB souborÅ¯ kontejnerÅ¯</h3>
<pre><code>dd if=/dev/zero of=/home/backupuser1/backupcontainer1.vc bs=1M count=524288
dd if=/dev/zero of=/home/backupuser2/backupcontainer2.vc bs=1M count=524288
</code></pre>
<h3>Inicializace VeraCrypt kontejnerÅ¯</h3>
<p>Pro uÅ¾ivatele <code>backupuser1</code>:</p>
<pre><code>veracrypt --text --create /home/backupuser1/backupcontainer1.vc \
  --size 512G --password=STRONG_PASSWORD1 --encryption=AES --hash=SHA-512 --filesystem=ext4
</code></pre>
<p>Pro uÅ¾ivatele <code>backupuser2</code>:</p>
<pre><code>veracrypt --text --create /home/backupuser2/backupcontainer2.vc \
  --size 512G --password=STRONG_PASSWORD2 --encryption=AES --hash=SHA-512 --filesystem=ext4
</code></pre>
<p><em>(Zvolte silnÃ¡ a bezpeÄnÃ¡ hesla.)</em></p>
<h3>VytvoÅ™enÃ­ mountpointÅ¯ a montovÃ¡nÃ­</h3>
<pre><code>sudo mkdir -p /mnt/backup1
sudo mkdir -p /mnt/backup2
</code></pre>
<p>MontovÃ¡nÃ­ kontejnerÅ¯:</p>
<pre><code>veracrypt --text --mount /home/backupuser1/backupcontainer1.vc /mnt/backup1 -p STRONG_PASSWORD1
veracrypt --text --mount /home/backupuser2/backupcontainer2.vc /mnt/backup2 -p STRONG_PASSWORD2
</code></pre>
<hr />
<h2>6. NastavenÃ­ Samba serveru ğŸŒ</h2>
<h3>Ãšprava <code>/etc/samba/smb.conf</code></h3>
<p>PÅ™idejte sekce:</p>
<pre><code>[Backup1]
   path = /mnt/backup1
   valid users = backupuser1
   read only = no
   browsable = yes

[Backup2]
   path = /mnt/backup2
   valid users = backupuser2
   read only = no
   browsable = yes
</code></pre>
<h3>Restart Samba</h3>
<pre><code>sudo systemctl restart smbd
</code></pre>
<hr />
<h2>7. NastavenÃ­ SSH klÃ­ÄÅ¯ ğŸ”‘</h2>
<h3>Na Windows 11 notebooku v PowerShellu</h3>
<p>Vygenerujte klÃ­Äe (pokud jeÅ¡tÄ› nejsou):</p>
<pre><code>ssh-keygen -t rsa -b 4096 -f $env:USERPROFILE\.ssh\id_rsa -N ""
</code></pre>
<h3>PÅ™eneste veÅ™ejnÃ½ klÃ­Ä na Raspberry Pi (nahraÄte IP a uÅ¾ivatele)</h3>
<pre><code>scp $env:USERPROFILE\.ssh\id_rsa.pub backupuser1@192.168.1.X:/home/backupuser1/
</code></pre>
<h3>Na Raspberry Pi (pro backupuser1)</h3>
<pre><code>mkdir -p /home/backupuser1/.ssh
cat /home/backupuser1/id_rsa.pub &gt;&gt; /home/backupuser1/.ssh/authorized_keys
chmod 700 /home/backupuser1/.ssh
chmod 600 /home/backupuser1/.ssh/authorized_keys
rm /home/backupuser1/id_rsa.pub
</code></pre>
<p><em>TotÃ©Å¾ opakujte pro <code>backupuser2</code> a druhÃ½ notebook.</em></p>
<hr />
<h2>8. PowerShell zÃ¡lohovacÃ­ skripty pro Windows 11 + nastavenÃ­ PlÃ¡novaÄe Ãºloh â°ğŸ–¥ï¸</h2>
<h3>Notebook 1 â€“ <code>BackupToRPi_User1.ps1</code></h3>
<pre><code># PowerShell skript pro zÃ¡lohu na Raspberry Pi Samba share Backup1

$RPiIP = "192.168.1.X"                      # IP RPi
$sharePath = "\\$RPiIP\Backup1"
$backupSource = "C:\DataToBackup"           # Zdroj zÃ¡lohy
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$backupDest = "$sharePath\Backup_$timestamp"

# PÅ™ipojenÃ­ Samba sdÃ­lenÃ­ pod pÃ­smenem Z:
New-PSDrive -Name "Z" -PSProvider FileSystem -Root $sharePath -Persist

# VytvoÅ™enÃ­ cÃ­lovÃ© sloÅ¾ky na sÃ­Å¥ovÃ©m disku
New-Item -ItemType Directory -Path $backupDest -Force | Out-Null

# KopÃ­rovÃ¡nÃ­ dat
Copy-Item -Path "$backupSource\*" -Destination $backupDest -Recurse -Force

# OdpojenÃ­ sÃ­Å¥ovÃ© jednotky
Remove-PSDrive -Name "Z"
</code></pre>
<hr />
<h3>Notebook 2 â€“ <code>BackupToRPi_User2.ps1</code></h3>
<pre><code># PowerShell skript pro zÃ¡lohu na Raspberry Pi Samba share Backup2

$RPiIP = "192.168.1.X"                      # IP RPi
$sharePath = "\\$RPiIP\Backup2"
$backupSource = "D:\WorkFiles"               # Zdroj zÃ¡lohy
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$backupDest = "$sharePath\Backup_$timestamp"

New-PSDrive -Name "Z" -PSProvider FileSystem -Root $sharePath -Persist
New-Item -ItemType Directory -Path $backupDest -Force | Out-Null
Copy-Item -Path "$backupSource\*" -Destination $backupDest -Recurse -Force
Remove-PSDrive -Name "Z"
</code></pre>
<hr />
<h3>NastavenÃ­ PlÃ¡novaÄe Ãºloh na Windows 11 ğŸ“…</h3>
<ol>
<li>OtevÅ™ete <strong>PlÃ¡novaÄ Ãºloh</strong> (Task Scheduler).  </li>
<li>VytvoÅ™te novou Ãºlohu:  </li>
<li>NÃ¡zev: <code>ZÃ¡loha na RPi BackupUser1</code> (resp. <code>BackupUser2</code>)  </li>
<li>SpouÅ¡tÄ›nÃ­: NapÅ™. kaÅ¾dÃ½ den v 19:00 nebo podle potÅ™eby  </li>
<li>Akce:  </li>
<li>Spustit program: <code>powershell.exe</code>  </li>
<li>Argumenty: <code>-File "C:\Cesta\k\souboru\BackupToRPi_User1.ps1"</code> (resp. User2)  </li>
<li>V zÃ¡loÅ¾ce <strong>ObecnÃ©</strong> zaÅ¡krtnÄ›te "Spustit s nejvyÅ¡Å¡Ã­mi oprÃ¡vnÄ›nÃ­mi"  </li>
<li>UloÅ¾te Ãºlohu.  </li>
</ol>
<hr />
<h2>9. Tipy a bezpeÄnostnÃ­ doporuÄenÃ­ âš ï¸ğŸ”’</h2>
<ul>
<li>KaÅ¾dÃ½ uÅ¾ivatel mÃ¡ vlastnÃ­ VeraCrypt kontejner a Samba ÃºÄet s oddÄ›lenÃ½mi prÃ¡vy.  </li>
<li>UchovÃ¡vejte silnÃ¡ a bezpeÄnÃ¡ hesla, ideÃ¡lnÄ› spravujte v password manageru.  </li>
<li>Raspberry Pi pravidelnÄ› aktualizujte (<code>sudo apt update &amp;&amp; sudo apt upgrade</code>).  </li>
<li>Omezte pÅ™Ã­stup v sÃ­ti (firewall) na potÅ™ebnÃ© IP adresy.  </li>
<li>PravidelnÄ› testujte obnovu dat ze zÃ¡loh.  </li>
<li>ZÃ¡lohujte i VeraCrypt kontejnery samotnÃ© (externÃ­ zÃ¡loha).  </li>
<li>PouÅ¾Ã­vejte SSH klÃ­Äe mÃ­sto hesel pro lepÅ¡Ã­ bezpeÄnost.  </li>
<li>PÅ™emÃ½Å¡lejte o monitoringu Raspberry Pi a Samba serveru.  </li>
</ul>
<hr />
<h2>10. Zdroje, citace a odkazy ğŸ“–ğŸŒ</h2>
<ul>
<li><a href="https://www.veracrypt.fr/en/Home.html">VeraCrypt Official</a>  </li>
<li><a href="https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html">Samba Documentation</a>  </li>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page">Microsoft Docs: Task Scheduler</a>  </li>
<li><a href="https://learn.microsoft.com/en-us/powershell/">Windows PowerShell Docs</a>  </li>
<li><a href="https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement">SSH Keygen on Windows</a>  </li>
<li><a href="https://www.raspberrypi.com/documentation/computers/">Raspberry Pi OS Documentation</a>  </li>
</ul>
<hr />
<p>Konec navodu! ğŸš€ğŸ˜Š  </p>
<p><a href="../index.html">â† ZpÄ›t na pÅ™ehled</a></p>
</body>
</html>
<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>backup ‚Äì z√°lohov√°n√≠ do RPi5</title></head>
<body>
<h1>üöÄ Kompletn√≠ n√°vod: ≈†ifrovan√Ω intranetov√Ω cloud pro z√°lohov√°n√≠ ze dvou Windows notebook≈Ø na RPi5 s NVMe diskem</h1>
<h1>1Ô∏è‚É£ P≈ô√≠prava RPi: aktualizace a slo≈æky</h1>
<p>sudo apt update &amp;&amp; sudo apt upgrade -y
sudo mkdir -p /mnt/cloud-notebook1-container /mnt/cloud-notebook2-container</p>
<h1>(Pokud NVMe je≈°tƒõ nen√≠ p≈ôipojen√Ω)</h1>
<p>lsblk  # zkontroluj za≈ô√≠zen√≠
sudo mkfs.ext4 /dev/nvme0n1p1  # POZOR: sma≈æe data!
sudo mount /dev/nvme0n1p1 /mnt</p>
<h1>2Ô∏è‚É£ Vytvo≈ôen√≠ pr√°zdn√Ωch VeraCrypt kontejner≈Ø (50GB)</h1>
<p>sudo fallocate -l 50G /mnt/cloud-notebook1-container/backup1.vc
sudo fallocate -l 50G /mnt/cloud-notebook2-container/backup2.vc</p>
<h1>3Ô∏è‚É£ Na Windows:</h1>
<h1>- vytvo≈ô kontejnery p≈ôes VeraCrypt GUI (https://www.veracrypt.fr/en/Downloads.html)</h1>
<h1>- nastav siln√© heslo, souborov√Ω syst√©m NTFS/ext4</h1>
<h1>- p≈ôenes kontejnerov√© soubory (.vc) zpƒõt na RPi do p≈ô√≠slu≈°n√Ωch slo≈æek</h1>
<h1>4Ô∏è‚É£ Instalace bal√≠ƒçk≈Ø na RPi</h1>
<p>sudo apt install veracrypt openssh-server samba -y
sudo systemctl enable --now ssh</p>
<h1>5Ô∏è‚É£ P≈ôipojen√≠ VeraCrypt kontejner≈Ø na RPi (p≈ôidej sv√© heslo)</h1>
<p>sudo veracrypt --mount /mnt/cloud-notebook1-container/backup1.vc /mnt/cloud-notebook1 --password="TvojeSilneHeslo" --non-interactive
sudo veracrypt --mount /mnt/cloud-notebook2-container/backup2.vc /mnt/cloud-notebook2 --password="TvojeSilneHeslo" --non-interactive</p>
<h1>6Ô∏è‚É£ Samba sd√≠len√≠ (voliteln√©)</h1>
<h1>Uprav /etc/samba/smb.conf p≈ôid√°n√≠m:</h1>
<h1>[notebook1]</h1>
<h1>path = /mnt/cloud-notebook1</h1>
<h1>valid users = liko</h1>
<h1>read only = no</h1>
<h1></h1>
<h1>[notebook2]</h1>
<h1>path = /mnt/cloud-notebook2</h1>
<h1>valid users = liko</h1>
<h1>read only = no</h1>
<p>sudo smbpasswd -a liko
sudo systemctl restart smbd</p>
<h1>7Ô∏è‚É£ Z√°lohov√°n√≠ z Windows</h1>
<h1>- P≈ôipoj Samba sd√≠len√≠ v Pr≈Øzkumn√≠ku: \IP_RPi\notebook1 a \IP_RPi\notebook2</h1>
<h1>- Nebo rsync p≈ôes WSL / DeltaCopy:</h1>
<h1>rsync -avz /mnt/c/Users/uzivatel/Documents/ liko@IP_RPi:/mnt/cloud-notebook1/</h1>
<h1>8Ô∏è‚É£ Automatick√Ω skript na RPi pro z√°lohy:</h1>
<p>cat &lt;&lt; 'EOF' &gt; ~/backup-cloud.sh</p>
<h1>!/bin/bash</h1>
<p>veracrypt --mount /mnt/cloud-notebook1-container/backup1.vc /mnt/cloud-notebook1 --password="TvojeSilneHeslo" --non-interactive
veracrypt --mount /mnt/cloud-notebook2-container/backup2.vc /mnt/cloud-notebook2 --password="TvojeSilneHeslo" --non-interactive</p>
<p>rsync -av --delete /home/liko/notebook1_data/ /mnt/cloud-notebook1/
rsync -av --delete /home/liko/notebook2_data/ /mnt/cloud-notebook2/</p>
<p>veracrypt -d /mnt/cloud-notebook1
veracrypt -d /mnt/cloud-notebook2
EOF</p>
<p>chmod +x ~/backup-cloud.sh</p>
<h1>9Ô∏è‚É£ Automatick√© p≈ôipojen√≠ VeraCrypt kontejner≈Ø p≈ôi startu RPi</h1>
<h1>Vytvo≈ô systemd slu≈æbu:</h1>
<p>cat &lt;&lt; 'EOF' | sudo tee /etc/systemd/system/veracrypt-mount.service
[Unit]
Description=Mount VeraCrypt containers at boot
After=network-online.target
Wants=network-online.target</p>
<p>[Service]
Type=oneshot
ExecStart=/usr/bin/veracrypt --mount /mnt/cloud-notebook1-container/backup1.vc /mnt/cloud-notebook1 --password="TvojeSilneHeslo" --non-interactive
ExecStart=/usr/bin/veracrypt --mount /mnt/cloud-notebook2-container/backup2.vc /mnt/cloud-notebook2 --password="TvojeSilneHeslo" --non-interactive
RemainAfterExit=yes</p>
<p>[Install]
WantedBy=multi-user.target
EOF</p>
<h1>Aktivuj slu≈æbu:</h1>
<p>sudo systemctl daemon-reload
sudo systemctl enable veracrypt-mount.service
sudo systemctl start veracrypt-mount.service</p>
<h1>10Ô∏è‚É£ PowerShell skript pro Windows z√°lohy na RPi (pomoc√≠ rsync p≈ôes WSL)</h1>
<h1>Ulo≈æ jako backup.ps1 na Windows (upravit IP a cesty):</h1>
<p>$source1 = "C:\Users\uzivatel\Documents\"
$source2 = "C:\Users\uzivatel\Pictures\"
$dest1 = "liko@IP_RPi:/mnt/cloud-notebook1/"
$dest2 = "liko@IP_RPi:/mnt/cloud-notebook2/"</p>
<h1>Nastav cestu k WSL rsync</h1>
<p>$rsync = "C:\Windows\System32\wsl.exe"</p>
<p>Write-Host "Spou≈°t√≠m z√°lohu Documents..."
&amp; $rsync rsync -avz --delete "$source1" "$dest1"</p>
<p>Write-Host "Spou≈°t√≠m z√°lohu Pictures..."
&amp; $rsync rsync -avz --delete "$source2" "$dest2"</p>
<p>Write-Host "Z√°lohov√°n√≠ dokonƒçeno."</p>
<h1>------------------------------------</h1>
<h1>üîó U≈æitoƒçn√© zdroje:</h1>
<h1>- VeraCrypt: https://www.veracrypt.fr/en/Home.html</h1>
<h1>- Rsync for Windows (WSL): https://learn.microsoft.com/en-us/windows/wsl/</h1>
<h1>- Samba: https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html</h1>
<h1>- RPi NVMe disk setup: https://www.raspberrypi.com/documentation/computers/storage.html</h1>
<h1>üöÄ Roz≈°√≠≈ôen√Ω n√°vod: Automatizace z√°loh na Windows + ≈°ifrov√°n√≠ dat p≈ôi z√°lohov√°n√≠ na RPi5</h1>
<h1>1Ô∏è‚É£ Automatick√© spou≈°tƒõn√≠ PowerShell z√°lohy pomoc√≠ Pl√°novaƒçe √∫loh (Task Scheduler) ve Windows:</h1>
<h1>- Otev≈ôi Task Scheduler (Pl√°novaƒç √∫loh)</h1>
<h1>- Klikni na "Create Basic Task..."</h1>
<h1>- Dej n√°zev nap≈ô. "Z√°loha na RPi"</h1>
<h1>- Nastav spou≈°tƒõn√≠ (dennƒõ, p≈ôi startu apod.)</h1>
<h1>- Akce: "Start a program"</h1>
<h1>- Program/script: powershell.exe</h1>
<h1>- P≈ôidej argumenty: -File "C:\cesta\k\backup.ps1"</h1>
<h1>- Dokonƒçi pr≈Øvodce</h1>
<h1>Pro kontrolu, ≈æe bƒõ≈æ√≠, m≈Ø≈æe≈° p≈ôidat do backup.ps1 logov√°n√≠, nap≈ô.:</h1>
<p>Add-Content -Path "C:\Users\uzivatel\backup.log" -Value "$(Get-Date): Z√°loha spu≈°tƒõna"</p>
<h1>2Ô∏è‚É£ ≈†ifrov√°n√≠ dat na cestƒõ p≈ôes SSH tunel pro rsync:</h1>
<h1>V PowerShell skriptu nahraƒè rsync p≈ô√≠kaz t√≠mto:</h1>
<p>$rsyncCmd = "rsync -avz -e <code>"ssh -p 22</code>" --delete <code>"$source1</code>" <code>"$dest1</code>""
Invoke-Expression $rsyncCmd</p>
<h1>nebo pokud pou≈æ√≠v√°≈° wsl.exe:</h1>
<p>$rsyncCmd1 = "rsync -avz -e 'ssh -p 22' --delete '$source1' '$dest1'"
$rsyncCmd2 = "rsync -avz -e 'ssh -p 22' --delete '$source2' '$dest2'"</p>
<p>&amp; wsl.exe $rsyncCmd1
&amp; wsl.exe $rsyncCmd2</p>
<h1>3Ô∏è‚É£ Doporuƒçen√≠ pro zabezpeƒçen√≠:</h1>
<h1>- Pou≈æ√≠vej SSH kl√≠ƒçe m√≠sto hesel pro p≈ôihl√°≈°en√≠ na RPi (generov√°n√≠: ssh-keygen)</h1>
<h1>- Zak√°zat p≈ôihl√°≈°en√≠ heslem na RPi (v /etc/ssh/sshd_config: PasswordAuthentication no)</h1>
<h1>- Pou≈æ√≠vej siln√° hesla pro VeraCrypt kontejnery</h1>
<h1>- Omez p≈ô√≠stup ke sd√≠len√Ωm slo≈æk√°m Samba jen na d≈Øvƒõryhodn√© IP adresy</h1>
<h1>- Pravidelnƒõ aktualizuj RPi a Windows</h1>
<h1>- Zva≈æ z√°lohu kontejner≈Ø na dal≈°√≠ offline m√©dium</h1>
<h1>------------------------------------</h1>
<h1>üîó U≈æitoƒçn√© zdroje:</h1>
<h1>- Windows Task Scheduler: https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page</h1>
<h1>- SSH keygen a konfigurace: https://linuxize.com/post/how-to-set-up-ssh-keys-on-ubuntu-20-04/</h1>
<h1>- Rsync p≈ôes SSH: https://linuxize.com/post/how-to-use-rsync-for-local-and-remote-data-transfer-and-synchronization/</h1>
<h1>- VeraCrypt bezpeƒçnostn√≠ doporuƒçen√≠: https://www.veracrypt.fr/en/Security%20Guide.html</h1>
<h1>üöÄ Kompletn√≠ automatizace z√°loh Windows -&gt; RPi5 s VeraCrypt kontejnery + SSH ≈°ifrov√°n√≠ + pl√°novaƒç √∫loh</h1>
<h1>1Ô∏è‚É£ Generov√°n√≠ SSH kl√≠ƒç≈Ø na Windows (PowerShell nebo Git Bash):</h1>
<p>ssh-keygen -t ed25519 -C "tvuj_email@domena.cz"</p>
<h1>Nech heslo pr√°zdn√© nebo nastav siln√© (doporuƒçeno)</h1>
<h1>V√Ωchoz√≠ um√≠stƒõn√≠: C:\Users\uzivatel.ssh\id_ed25519 a id_ed25519.pub</h1>
<h1>2Ô∏è‚É£ Nahr√°n√≠ ve≈ôejn√©ho kl√≠ƒçe na RPi (pro u≈æivatele 'liko'):</h1>
<p>scp ~/.ssh/id_ed25519.pub liko@IP_RPi:~/
ssh liko@IP_RPi</p>
<h1>Na RPi:</h1>
<p>mkdir -p ~/.ssh
cat ~/id_ed25519.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
rm ~/id_ed25519.pub</p>
<h1>3Ô∏è‚É£ Zak√°z√°n√≠ p≈ôihl√°≈°en√≠ heslem na RPi:</h1>
<p>sudo nano /etc/ssh/sshd_config</p>
<h1>Najdi a uprav nebo p≈ôidej:</h1>
<p>PasswordAuthentication no</p>
<h1>Restart SSH slu≈æby:</h1>
<p>sudo systemctl restart ssh</p>
<h1>4Ô∏è‚É£ PowerShell skript z√°lohy s rsync p≈ôes SSH (ulo≈æ nap≈ô. jako backup.ps1):</h1>
<p>$source1 = "C:\Users\uzivatel\Documents\"
$source2 = "C:\Users\uzivatel\Pictures\"
$dest1 = "liko@IP_RPi:/mnt/cloud-notebook1/"
$dest2 = "liko@IP_RPi:/mnt/cloud-notebook2/"
$rsync = "C:\Windows\System32\wsl.exe"</p>
<p>Write-Host "Spou≈°t√≠m z√°lohu Documents p≈ôes SSH..."
&amp; $rsync rsync -avz -e "ssh -i /mnt/c/Users/uzivatel/.ssh/id_ed25519 -p 22" --delete "$source1" "$dest1"</p>
<p>Write-Host "Spou≈°t√≠m z√°lohu Pictures p≈ôes SSH..."
&amp; $rsync rsync -avz -e "ssh -i /mnt/c/Users/uzivatel/.ssh/id_ed25519 -p 22" --delete "$source2" "$dest2"</p>
<p>Write-Host "Z√°lohov√°n√≠ dokonƒçeno."</p>
<h1>5Ô∏è‚É£ Napl√°nov√°n√≠ automatick√© z√°lohy pomoc√≠ Pl√°novaƒçe √∫loh Windows:</h1>
<h1>- Otev≈ôi Pl√°novaƒç √∫loh (Task Scheduler)</h1>
<h1>- Klikni na "Create Basic Task..."</h1>
<h1>- N√°zev: "Z√°loha na RPi p≈ôes SSH"</h1>
<h1>- Spou≈°tƒõn√≠: nap≈ô. dennƒõ v 3:00 r√°no</h1>
<h1>- Akce: Start a program</h1>
<h1>- Program/script: powershell.exe</h1>
<h1>- P≈ôidej argumenty: -File "C:\cesta\k\backup.ps1"</h1>
<h1>- Dokonƒçi a zkontroluj, ≈æe √∫loha funguje</h1>
<h1>6Ô∏è‚É£ Na RPi: automatick√© p≈ôipojen√≠ VeraCrypt kontejner≈Ø p≈ôi startu</h1>
<p>sudo tee /etc/systemd/system/veracrypt-mount.service &gt; /dev/null &lt;&lt; 'EOF'
[Unit]
Description=Mount VeraCrypt containers at boot
After=network-online.target
Wants=network-online.target</p>
<p>[Service]
Type=oneshot
ExecStart=/usr/bin/veracrypt --mount /mnt/cloud-notebook1-container/backup1.vc /mnt/cloud-notebook1 --password="TvojeSilneHeslo" --non-interactive
ExecStart=/usr/bin/veracrypt --mount /mnt/cloud-notebook2-container/backup2.vc /mnt/cloud-notebook2 --password="TvojeSilneHeslo" --non-interactive
RemainAfterExit=yes</p>
<p>[Install]
WantedBy=multi-user.target
EOF</p>
<p>sudo systemctl daemon-reload
sudo systemctl enable veracrypt-mount.service
sudo systemctl start veracrypt-mount.service</p>
<h1>7Ô∏è‚É£ Doporuƒçen√≠ zabezpeƒçen√≠:</h1>
<h1>- Pou≈æ√≠vej SSH kl√≠ƒçe, ne hesla</h1>
<h1>- Zak√°zat hesla na SSH na RPi</h1>
<h1>- Siln√° hesla pro VeraCrypt kontejnery</h1>
<h1>- Omez p≈ô√≠stup Samba na intern√≠ IP adresy</h1>
<h1>- Pravidelnƒõ aktualizuj syst√©m a software</h1>
<h1>- Z√°lohuj kontejnerov√© soubory i na offline m√©dium</h1>
<h1>------------------------------------</h1>
<h1>üîó U≈æitoƒçn√© zdroje:</h1>
<h1>- SSH kl√≠ƒçe na Windows: https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement</h1>
<h1>- Rsync p≈ôes SSH v PowerShell: https://stackoverflow.com/questions/30437510/how-to-run-rsync-on-windows</h1>
<h1>- VeraCrypt: https://www.veracrypt.fr/en/Home.html</h1>
<h1>- Systemd slu≈æba: https://www.freedesktop.org/software/systemd/man/systemd.service.html</h1>
<h1>- Windows Task Scheduler: https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page</h1>
<h1>üîë Detailn√≠ n√°vod: Nastaven√≠ SSH kl√≠ƒç≈Ø Windows -&gt; RPi, PowerShell z√°loha s logy a zabezpeƒçen√Ω Samba p≈ô√≠stup</h1>
<h1>1Ô∏è‚É£ Generov√°n√≠ SSH kl√≠ƒç≈Ø na Windows</h1>
<h1>Otev≈ôi PowerShell nebo Git Bash a spus≈•:</h1>
<p>ssh-keygen -t ed25519 -C "tvuj_email@domena.cz"</p>
<h1>- P≈ôijmi v√Ωchoz√≠ um√≠stƒõn√≠ (C:\Users\uzivatel.ssh\id_ed25519)</h1>
<h1>- Nastav siln√© heslo nebo ponech pr√°zdn√© (doporuƒçeno heslo)</h1>
<h1>- Po dokonƒçen√≠ bys mƒõl m√≠t dva soubory:</h1>
<h1>- id_ed25519 (soukrom√Ω kl√≠ƒç)</h1>
<h1>- id_ed25519.pub (ve≈ôejn√Ω kl√≠ƒç)</h1>
<h1>2Ô∏è‚É£ P≈ôenos ve≈ôejn√©ho kl√≠ƒçe na RPi</h1>
<p>scp C:\Users\uzivatel.ssh\id_ed25519.pub liko@IP_RPi:~</p>
<h1>P≈ôihlas se na RPi:</h1>
<p>ssh liko@IP_RPi</p>
<h1>Na RPi spus≈•:</h1>
<p>mkdir -p ~/.ssh
cat ~/id_ed25519.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
rm ~/id_ed25519.pub</p>
<h1>3Ô∏è‚É£ Ovƒõ≈ôen√≠, ≈æe SSH p≈ôihl√°≈°en√≠ funguje bez hesla:</h1>
<p>ssh -i ~/.ssh/id_ed25519 liko@IP_RPi</p>
<h1>Pokud se p≈ôihl√°s√≠≈° bez zad√°n√≠ hesla, je v≈°e OK.</h1>
<h1>4Ô∏è‚É£ Zak√°z√°n√≠ p≈ôihl√°≈°en√≠ heslem na RPi pro vy≈°≈°√≠ bezpeƒçnost:</h1>
<p>sudo nano /etc/ssh/sshd_config</p>
<h1>Najdi ≈ô√°dek:</h1>
<h1>PasswordAuthentication yes</h1>
<h1>a zmƒõ≈à na:</h1>
<p>PasswordAuthentication no</p>
<h1>Ulo≈æ a restartuj SSH slu≈æbu:</h1>
<p>sudo systemctl restart ssh</p>
<h1>5Ô∏è‚É£ PowerShell skript z√°lohy s logov√°n√≠m a o≈°et≈ôen√≠m chyb (backup.ps1):</h1>
<p>$logFile = "C:\Users\uzivatel\backup.log"
function LogWrite($msg) {
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    Add-Content -Path $logFile -Value "$timestamp : $msg"
}</p>
<p>try {
    LogWrite "=== Z√°loha spu≈°tƒõna ==="</p>
<pre><code>$source1 = "C:\Users\uzivatel\Documents\"
$source2 = "C:\Users\uzivatel\Pictures\"
$dest1 = "liko@IP_RPi:/mnt/cloud-notebook1/"
$dest2 = "liko@IP_RPi:/mnt/cloud-notebook2/"
$rsync = "C:\Windows\System32\wsl.exe"

LogWrite "Z√°loha Documents spu≈°tƒõna..."
&amp; $rsync rsync -avz -e "ssh -i /mnt/c/Users/uzivatel/.ssh/id_ed25519 -p 22" --delete "$source1" "$dest1"
if ($LASTEXITCODE -ne 0) {
    LogWrite "Chyba p≈ôi z√°loze Documents!"
    throw "Rsync selhal"
}

LogWrite "Z√°loha Pictures spu≈°tƒõna..."
&amp; $rsync rsync -avz -e "ssh -i /mnt/c/Users/uzivatel/.ssh/id_ed25519 -p 22" --delete "$source2" "$dest2"
if ($LASTEXITCODE -ne 0) {
    LogWrite "Chyba p≈ôi z√°loze Pictures!"
    throw "Rsync selhal"
}

LogWrite "=== Z√°loha dokonƒçena √∫spƒõ≈°nƒõ ==="
</code></pre>
<p>}
catch {
    LogWrite "V√Ωjimka: $_"
}</p>
<h1>6Ô∏è‚É£ Nastaven√≠ zabezpeƒçen√©ho Samba p≈ô√≠stupu na RPi</h1>
<p>sudo nano /etc/samba/smb.conf</p>
<h1>P≈ôidej na konec:</h1>
<p>[notebook1]
   path = /mnt/cloud-notebook1
   valid users = liko
   read only = no
   hosts allow = 10.20.1.0/24 192.168.1.0/24 127.0.0.1
   # povolit p≈ô√≠stup jen z lok√°ln√≠ s√≠tƒõ, uprav podle sv√© s√≠tƒõ</p>
<p>[notebook2]
   path = /mnt/cloud-notebook2
   valid users = liko
   read only = no
   hosts allow = 10.20.1.0/24 192.168.1.0/24 127.0.0.1</p>
<h1>Restartuj Samba slu≈æbu:</h1>
<p>sudo systemctl restart smbd</p>
<h1>7Ô∏è‚É£ Dal≈°√≠ tipy zabezpeƒçen√≠ Samba:</h1>
<h1>- Pou≈æij siln√© heslo u≈æivatele 'liko':</h1>
<p>sudo smbpasswd liko</p>
<h1>- Pravidelnƒõ kontroluj /var/log/samba/log.smbd pro podez≈ôel√© aktivity</h1>
<h1>- Omez p≈ô√≠stup pomoc√≠ firewallu (ufw nebo iptables)</h1>
<h1>nap≈ô. sudo ufw allow from 10.20.1.0/24 to any port 445 proto tcp</h1>
<h1>------------------------------------</h1>
<h1>üîó U≈æitoƒçn√© zdroje:</h1>
<h1>- SSH kl√≠ƒçe: https://linuxize.com/post/how-to-set-up-ssh-keys-on-ubuntu/</h1>
<h1>- PowerShell logov√°n√≠: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-content</h1>
<h1>- Samba hosts allow: https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html</h1>
<h1>- Rsync pro Windows: https://stackoverflow.com/questions/30437510/how-to-run-rsync-on-windows</h1>
<h1>1Ô∏è‚É£ Hotov√Ω Task Scheduler export (XML)</h1>
<h1>Tento soubor m≈Ø≈æe≈° importovat ve Windows Pl√°novaƒçi √∫loh (Task Scheduler) p≈ôes:</h1>
<h1>Action ‚Üí Import Task...</h1>
<?xml version="1.0" encoding="UTF-16"?>
<p><Task version="1.4" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <RegistrationInfo>
    <Date>2025-07-19T08:00:00</Date>
    <Author>uzivatel</Author>
    <Description>Z√°loha na RPi p≈ôes SSH s PowerShellem</Description>
  </RegistrationInfo>
  <Triggers>
    <CalendarTrigger>
      <StartBoundary>2025-07-20T03:00:00</StartBoundary>
      <ScheduleByDay>
        <DaysInterval>1</DaysInterval>
      </ScheduleByDay>
      <Enabled>true</Enabled>
    </CalendarTrigger>
  </Triggers>
  <Principals>
    <Principal id="Author">
      <UserId>uzivatel</UserId>
      <RunLevel>LeastPrivilege</RunLevel>
    </Principal>
  </Principals>
  <Settings>
    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>
    <DisallowStartIfOnBatteries>true</DisallowStartIfOnBatteries>
    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>
    <AllowHardTerminate>true</AllowHardTerminate>
    <StartWhenAvailable>true</StartWhenAvailable>
    <RunOnlyIfNetworkAvailable>true</RunOnlyIfNetworkAvailable>
    <IdleSettings>
      <StopOnIdleEnd>true</StopOnIdleEnd>
      <RestartOnIdle>false</RestartOnIdle>
    </IdleSettings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
    <Hidden>false</Hidden>
    <RunOnlyIfIdle>false</RunOnlyIfIdle>
    <WakeToRun>false</WakeToRun>
    <ExecutionTimeLimit>PT1H</ExecutionTimeLimit>
    <Priority>7</Priority>
  </Settings>
  <Actions Context="Author">
    <Exec>
      <Command>powershell.exe</Command>
      <Arguments>-File "C:\cesta\k\backup.ps1"</Arguments>
    </Exec>
  </Actions>
</Task></p>
<h1>------------------------------------</h1>
<h1>2Ô∏è‚É£ RPi automatizovan√° instalace a konfigurace Samba + firewall (bash script)</h1>
<p>sudo tee ~/setup_samba_firewall.sh &gt; /dev/null &lt;&lt; 'EOF'</p>
<h1>!/bin/bash</h1>
<p>set -e</p>
<p>echo "Aktualizuji syst√©m..."
sudo apt update &amp;&amp; sudo apt upgrade -y</p>
<p>echo "Instaluji Samba..."
sudo apt install samba -y</p>
<p>echo "Vytv√°≈ô√≠m sd√≠len√≠ pro cloud-notebook1 a cloud-notebook2..."</p>
<p>sudo mkdir -p /mnt/cloud-notebook1 /mnt/cloud-notebook2
sudo chown liko:liko /mnt/cloud-notebook1 /mnt/cloud-notebook2</p>
<p>sudo bash -c 'cat &gt;&gt; /etc/samba/smb.conf' &lt;&lt; EOL</p>
<p>[notebook1]
   path = /mnt/cloud-notebook1
   valid users = liko
   read only = no
   hosts allow = 10.20.1.0/24 192.168.1.0/24 127.0.0.1</p>
<p>[notebook2]
   path = /mnt/cloud-notebook2
   valid users = liko
   read only = no
   hosts allow = 10.20.1.0/24 192.168.1.0/24 127.0.0.1
EOL</p>
<p>echo "Nastavuji Samba u≈æivatele (nastav heslo pro 'liko')..."
sudo smbpasswd -a liko
sudo smbpasswd -e liko</p>
<p>echo "Restartuji Samba slu≈æbu..."
sudo systemctl restart smbd</p>
<p>echo "Instaluji a konfiguruj firewall UFW..."</p>
<p>sudo apt install ufw -y
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow from 10.20.1.0/24 to any port 445 proto tcp
sudo ufw allow from 192.168.1.0/24 to any port 445 proto tcp
sudo ufw enable</p>
<p>echo "Samba a firewall nastaveny!"
EOF</p>
<p>chmod +x ~/setup_samba_firewall.sh
echo "Spus≈• p≈ô√≠kaz: ./setup_samba_firewall.sh jako u≈æivatel 'liko' s sudo pr√°vy."</p>
<h1>------------------------------------</h1>
<h1>3Ô∏è‚É£ PowerShell skript s e-mailovou notifikac√≠ po z√°loze</h1>
<p>$logFile = "C:\Users\uzivatel\backup.log"
$smtpServer = "smtp.tvoje-domena.cz"
$smtpPort = 587
$smtpUser = "uzivatel@tvoje-domena.cz"
$smtpPass = "TvojeHeslo"
$toEmail = "uzivatel@tvoje-domena.cz"
$fromEmail = "backup@tvoje-domena.cz"
$subject = "Z√°loha na RPi dokonƒçena"
$bodySuccess = "Z√°loha byla dokonƒçena √∫spƒõ≈°nƒõ.`nViz p≈ôilo≈æen√Ω log."
$bodyFail = "Z√°loha selhala! Viz log."</p>
<p>function LogWrite($msg) {
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    Add-Content -Path $logFile -Value "$timestamp : $msg"
}</p>
<p>function Send-Email($subject, $body) {
    $message = New-Object System.Net.Mail.MailMessage
    $message.From = $fromEmail
    $message.To.Add($toEmail)
    $message.Subject = $subject
    $message.Body = $body
    $smtp = New-Object Net.Mail.SmtpClient($smtpServer, $smtpPort)
    $smtp.EnableSsl = $true
    $smtp.Credentials = New-Object System.Net.NetworkCredential($smtpUser, $smtpPass)
    $smtp.Send($message)
}</p>
<p>try {
    LogWrite "=== Z√°loha spu≈°tƒõna ==="</p>
<pre><code># zde zavol√°≈° rsync jak d≈ô√≠ve
# nap≈ô. &amp; wsl.exe rsync -avz -e "ssh -i /mnt/c/Users/uzivatel/.ssh/id_ed25519" --delete $source $dest

LogWrite "=== Z√°loha dokonƒçena √∫spƒõ≈°nƒõ ==="
Send-Email $subject $bodySuccess
</code></pre>
<p>}
catch {
    LogWrite "V√Ωjimka: $_"
    Send-Email $subject $bodyFail
}</p>
<h1>üî• Dal≈°√≠ pokroƒçil√© automatizace a zabezpeƒçen√≠ intranetov√©ho cloudu na RPi + Windows z√°lohy</h1>
<h1>1Ô∏è‚É£ Automatick√© p≈ôipojen√≠ VeraCrypt kontejner≈Ø p≈ôi startu RPi</h1>
<h1>Nainstaluj VeraCrypt (pokud nem√°≈°):</h1>
<p>sudo apt install veracrypt -y</p>
<h1>Vytvo≈ô shell skript nap≈ô. ~/mount-veracrypt.sh:</h1>
<p>cat &gt; ~/mount-veracrypt.sh &lt;&lt; 'EOF'</p>
<h1>!/bin/bash</h1>
<h1>Mount VeraCrypt container automaticky p≈ôi startu</h1>
<h1>Cesta k VeraCrypt soubor≈Øm</h1>
<p>CONTAINER1="/mnt/veracrypt/cloud-notebook1.hc"
CONTAINER2="/mnt/veracrypt/cloud-notebook2.hc"</p>
<h1>Mount pointy</h1>
<p>MOUNT1="/mnt/cloud-notebook1"
MOUNT2="/mnt/cloud-notebook2"</p>
<h1>Hesla (doporuƒçeno lep≈°√≠ zabezpeƒçen√≠, nap≈ô. keyfile nebo prompt)</h1>
<p>PASS1="TvojeSilneHeslo1"
PASS2="TvojeSilneHeslo2"</p>
<p>veracrypt --text --non-interactive --password="$PASS1" --mount "$CONTAINER1" "$MOUNT1"
veracrypt --text --non-interactive --password="$PASS2" --mount "$CONTAINER2" "$MOUNT2"
EOF</p>
<p>chmod +x ~/mount-veracrypt.sh</p>
<h1>P≈ôidej spou≈°tƒõn√≠ do crontabu pro root, aby se spustilo p≈ôi startu:</h1>
<p>sudo crontab -e</p>
<h1>P≈ôidej ≈ô√°dek:</h1>
<p>@reboot /home/liko/mount-veracrypt.sh</p>
<h1>2Ô∏è‚É£ Windows PowerShell skript pro z√°lohy na VeraCrypt p≈ôipojen√© sd√≠len√≠</h1>
<p>$logFile = "C:\Users\uzivatel\backup.log"
$source1 = "C:\Users\uzivatel\Documents\"
$source2 = "C:\Users\uzivatel\Pictures\"
$dest1 = "\RPi5\notebook1"
$dest2 = "\RPi5\notebook2"</p>
<p>function LogWrite($msg) {
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    Add-Content -Path $logFile -Value "$timestamp : $msg"
}</p>
<p>try {
    LogWrite "=== Z√°loha spu≈°tƒõna ==="</p>
<pre><code>LogWrite "Z√°loha Documents spu≈°tƒõna..."
robocopy $source1 $dest1 /MIR /Z /R:3 /W:5 /LOG+:$logFile
if ($LASTEXITCODE -ge 8) { throw "Robocopy chyba" }

LogWrite "Z√°loha Pictures spu≈°tƒõna..."
robocopy $source2 $dest2 /MIR /Z /R:3 /W:5 /LOG+:$logFile
if ($LASTEXITCODE -ge 8) { throw "Robocopy chyba" }

LogWrite "=== Z√°loha dokonƒçena √∫spƒõ≈°nƒõ ==="
</code></pre>
<p>}
catch {
    LogWrite "V√Ωjimka: $_"
}</p>
<h1>3Ô∏è‚É£ ≈†ifrov√°n√≠ dat na cestƒõ: pou≈æit√≠ SSH tunelu a AES ≈°ifrovan√Ωch protokol≈Ø</h1>
<h1>Doporuƒçuji rsync p≈ôes SSH (u≈æ m√°me), p≈ô√≠padnƒõ VPN tunel (WireGuard):</h1>
<h1>Z√°kladn√≠ nastaven√≠ WireGuard mezi Windows a RPi:</h1>
<h1>Na RPi:</h1>
<p>sudo apt install wireguard -y
wg genkey | tee privatekey | wg pubkey &gt; publickey</p>
<h1>Na Windows: st√°hni WireGuard client, nastav konfiguraci s priv√°tn√≠ a ve≈ôejnou kl√≠ƒçem, adresou apod.</h1>
<h1>Pak p≈ôesmƒõruje≈° z√°lohy p≈ôes WireGuard VPN ‚Äì ve≈°ker√° komunikace je bezpeƒçnƒõ ≈°ifrovan√°.</h1>
<h1>4Ô∏è‚É£ Automatick√© spou≈°tƒõn√≠ PowerShell skriptu p≈ôes Task Scheduler</h1>
<h1>Pou≈æij XML export ze d≈ô√≠vƒõj≈°ka nebo vytvo≈ô √∫lohu:</h1>
<h1>powershell.exe -File "C:\cesta\k\backup.ps1"</h1>
<h1>Napl√°nuj denn√≠ ƒçi hodinov√© spu≈°tƒõn√≠, podle pot≈ôeby.</h1>
<h1>------------------------------------</h1>
<h1>üß∞ Tipy pro dal≈°√≠ zabezpeƒçen√≠:</h1>
<h1>- Pravidelnƒõ z√°lohuj SSH kl√≠ƒçe a VeraCrypt kontejnery offline</h1>
<h1>- Pou≈æ√≠vej siln√° hesla + keyfiles u VeraCrypt</h1>
<h1>- Omez p≈ô√≠stup p≈ôes firewall, whitelist IP adres</h1>
<h1>- Loguj a monitoruj ne√∫spƒõ≈°n√© pokusy o p≈ô√≠stup</h1>
<h1>- Udr≈æuj syst√©m aktu√°ln√≠ (RPi i Windows)</h1>
<h1>- Zva≈æ automatizovan√© upozornƒõn√≠ (e-mail, Telegram bot)</h1>
<h1>------------------------------------</h1>
<h1>üîó Zdrojov√© reference:</h1>
<h1>- VeraCrypt command line: https://www.veracrypt.fr/en/Command%20Line%20Usage.html</h1>
<h1>- WireGuard quickstart: https://www.wireguard.com/quickstart/</h1>
<h1>- Robocopy dokumentace: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/robocopy</h1>
<h1>- PowerShell logging best practices: https://devblogs.microsoft.com/powershell/powershell-tracing-and-logging/</h1>
<p><a href="../index.html">‚Üê Zpƒõt na p≈ôehled</a></p>
</body>
</html>